'use client';

import { useEffect, useRef, useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { motion } from "framer-motion";

const symbols = ["ğŸ’", "ğŸ‹", "ğŸ””", "ğŸ’", "7ï¸âƒ£"];

export default function FakeCasinoApp() {
  // ğŸ‘¤ login
  const [user, setUser] = useState<string | null>(null);
  const [loginInput, setLoginInput] = useState("");

  // ğŸ’° game state
  const [balance, setBalance] = useState(1000);
  const [bet, setBet] = useState(50);
  const [rouletteResult, setRouletteResult] = useState<number | null>(null);
  const [slot, setSlot] = useState(["â”", "â”", "â”"]);
  const [spinning, setSpinning] = useState(false);
  const [jackpot, setJackpot] = useState(5000);
  const [wheelRotation, setWheelRotation] = useState(0);

  // ğŸ”Š sounds
  const spinSound = useRef<HTMLAudioElement | null>(null);
  const winSound = useRef<HTMLAudioElement | null>(null);

  // ================= LOAD / SAVE =================
  useEffect(() => {
    const savedUser = localStorage.getItem("casino_user");
    const savedBalance = localStorage.getItem("casino_balance");
    const savedJackpot = localStorage.getItem("casino_jackpot");

    if (savedUser) setUser(savedUser);
    if (savedBalance) setBalance(Number(savedBalance));
    if (savedJackpot) setJackpot(Number(savedJackpot));
  }, []);

  useEffect(() => {
    if (user) localStorage.setItem("casino_user", user);
  }, [user]);

  useEffect(() => {
    localStorage.setItem("casino_balance", String(balance));
  }, [balance]);

  useEffect(() => {
    localStorage.setItem("casino_jackpot", String(jackpot));
  }, [jackpot]);

  // ================= LOGIN =================
  const handleLogin = () => {
    if (!loginInput.trim()) return;
    setUser(loginInput.trim());
  };

  const handleLogout = () => {
    setUser(null);
    localStorage.removeItem("casino_user");
  };

  // ================= ROULETTE =================
  const spinRoulette = () => {
    if (balance < bet) return;

    spinSound.current?.play().catch(() => {});

    setBalance((b) => b - bet);

    const result = Math.floor(Math.random() * 37);
    setRouletteResult(result);

    // ğŸ¡ animate wheel
    const extraSpin = 360 * (3 + Math.random() * 3);
    setWheelRotation((r) => r + extraSpin);

    // fake win chance
    if (Math.random() < 0.45) {
      const win = bet * 2;
      setTimeout(() => {
        setBalance((b) => b + win);
        winSound.current?.play().catch(() => {});
      }, 1200);
    }

    setJackpot((j) => j + Math.floor(bet * 0.1));
  };

  // ================= SLOTS =================
  const spinSlots = () => {
    if (balance < bet || spinning) return;

    spinSound.current?.play().catch(() => {});

    setSpinning(true);
    setBalance((b) => b - bet);

    setTimeout(() => {
      const newSlot = [
        symbols[Math.floor(Math.random() * symbols.length)],
        symbols[Math.floor(Math.random() * symbols.length)],
        symbols[Math.floor(Math.random() * symbols.length)],
      ];

      setSlot(newSlot);

      // ğŸ† jackpot
      if (newSlot.every((s) => s === "7ï¸âƒ£")) {
        setBalance((b) => b + jackpot);
        setJackpot(5000);
        winSound.current?.play().catch(() => {});
      }
      // normal win
      else if (newSlot[0] === newSlot[1] && newSlot[1] === newSlot[2]) {
        setBalance((b) => b + bet * 5);
        winSound.current?.play().catch(() => {});
      }

      setJackpot((j) => j + Math.floor(bet * 0.2));
      setSpinning(false);
    }, 1200);
  };

  const resetBalance = () => {
    setBalance(1000);
    setJackpot(5000);
  };

  // ================= LOGIN SCREEN =================
  if (!user) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-black text-white p-6">
        <Card className="bg-black/70 border-emerald-500 w-full max-w-md">
          <CardContent className="p-6 space-y-4 text-center">
            <h1 className="text-3xl font-bold">ğŸ° Fake Casino</h1>
            <Input
              placeholder="Nick..."
              value={loginInput}
              onChange={(e) => setLoginInput(e.target.value)}
            />
            <Button onClick={handleLogin} className="w-full">
              WejdÅº do kasyna
            </Button>
          </CardContent>
        </Card>
      </div>
    );
  }

  // ================= MAIN APP =================
  return (
    <div className="min-h-screen bg-gradient-to-br from-emerald-900 via-black to-emerald-950 p-6 text-white">
      {/* sounds */}
      <audio ref={spinSound} src="https://assets.mixkit.co/active_storage/sfx/2004/2004-preview.mp3" />
      <audio ref={winSound} src="https://assets.mixkit.co/active_storage/sfx/1998/1998-preview.mp3" />

      <div className="max-w-6xl mx-auto space-y-6">
        <motion.h1
          initial={{ opacity: 0, y: -20 }}
          animate={{ opacity: 1, y: 0 }}
          className="text-4xl font-bold text-center"
        >
          ğŸ° Fake C
